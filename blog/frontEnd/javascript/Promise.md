---
icon: pen-to-square
date: 1970-01-01
category:
  - å‰ç«¯
# tag:
#  - é¡µé¢é…ç½®
#star: 1
#article: true
#cover: 
---
 
# Promise

> 1. ç†è§£Promise A+è§„èŒƒçš„åŸºæœ¬æ¦‚å¿µ
> 2. å­¦ä¼šåˆ›å»ºPromise
> 3. å­¦ä¼šé’ˆå¯¹Promiseè¿›è¡Œåç»­å¤„ç†

<!-- more -->

ç¬”è®°å‚è€ƒï¼š [æ¸¡ä¸€æ•™è‚²](https://www.baidu.com/s?wd=%E6%B8%A1%E4%B8%80%E6%95%99%E8%82%B2)

## æ€»ç»“å›¾
å¤šçœ‹

![alt text](assets/Promise/image.png)

## é‚“å“¥çš„çƒ¦æ¼


é‚“å“¥å¿ƒä¸­æœ‰å¾ˆå¤šå¥³ç¥ï¼Œä»–ä»Šå¤©ä¸‹å®šå†³å¿ƒï¼Œè¦å‘è¿™äº›å¥³ç¥è¡¨ç™½ï¼Œä»–è®¤ä¸ºï¼Œåªè¦å¥³ç¥å¤Ÿå¤šï¼Œæ ¹æ®æ¦‚ç‡å­¦åŸç†ï¼Œæ€»æœ‰ä¸€ä¸ªä¼šæ¥æ”¶ä»–



ç¨³å¦¥èµ·è§ï¼Œé‚“å“¥å†³å®šä½¿ç”¨**ä¸²è¡Œ**çš„æ–¹å¼è¿›è¡Œè¡¨ç™½ï¼šå…ˆç»™ç¬¬1ä½å¥³ç¥å‘é€çŸ­ä¿¡ï¼Œç„¶åç­‰å¾…å¥³ç¥çš„å›åº”ï¼Œå¦‚æœæˆåŠŸäº†ï¼Œå°±ç»“æŸï¼Œå¦‚æœå¤±è´¥äº†ï¼Œåˆ™å†ç»™ç¬¬2ä½å¥³ç¥å‘é€çŸ­ä¿¡ï¼Œä¾æ¬¡ç±»æ¨



![alt text](assets/Promise/image-1.png)



é‚“å“¥çš„å¥³ç¥ä¸€å…±æœ‰4ä½ï¼Œåå­—åˆ†åˆ«æ˜¯ï¼šæå»ºå›½ã€ç‹å¯Œè´µã€å‘¨èšè´¢ã€åˆ˜äººå‹‡



å‘çŸ­ä¿¡æ˜¯ä¸€ä¸ªé‡å¤æ€§çš„åŠ³åŠ¨ï¼Œé‚“å“¥æ˜¯ä¸ªç¨‹åºå‘˜ï¼Œå› æ­¤å†³å®šç”¨å‡½æ•°å°è£…è¿™ä¸ªåŠ¨ä½œ



```javascript
// å‘æŸä½å¥³ç”Ÿå‘é€ä¸€åˆ™è¡¨ç™½çŸ­ä¿¡
// name: å¥³ç¥çš„å§“å
// onFulffiled: æˆåŠŸåçš„å›è°ƒ
// onRejected: å¤±è´¥åçš„å›è°ƒ
function sendMessage(name, onFulffiled, onRejected) {
  // æ¨¡æ‹Ÿ å‘é€è¡¨ç™½çŸ­ä¿¡
  console.log(
    `é‚“å“¥ -> ${name}ï¼šæœ€è¿‘æœ‰è°£è¨€è¯´æˆ‘å–œæ¬¢ä½ ï¼Œæˆ‘è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œé‚£ä¸æ˜¯è°£è¨€ğŸ˜˜`
  );
  console.log(`ç­‰å¾…${name}å›å¤......`);
  // æ¨¡æ‹Ÿ å¥³ç¥å›å¤éœ€è¦ä¸€æ®µæ—¶é—´
  setTimeout(() => {
    // æ¨¡æ‹Ÿ æœ‰10%çš„å‡ ç‡æˆåŠŸ
    if (Math.random() <= 0.1) {
      // æˆåŠŸï¼Œè°ƒç”¨ onFuffiledï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
      onFulffiled(`${name} -> é‚“å“¥ï¼šæˆ‘æ˜¯ä¹ï¼Œä½ æ˜¯ä¸‰ï¼Œé™¤äº†ä½ è¿˜æ˜¯ä½ ğŸ˜˜`);
    } else {
      // å¤±è´¥ï¼Œè°ƒç”¨ onRejectedï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
      onRejected(`${name} -> é‚“å“¥ï¼šä½ æ˜¯ä¸ªå¥½äººğŸ˜œ`);
    }
  }, 1000);
}
```



æœ‰äº†è¿™ä¸ªå‡½æ•°åï¼Œé‚“å“¥äºæ˜¯å¼€å§‹ç¼–å†™ç¨‹åºå‘é€çŸ­ä¿¡äº†



```javascript
// é¦–å…ˆå‘ æå»ºå›½ å‘é€æ¶ˆæ¯
sendMessage(
  'æå»ºå›½',
  (reply) => {
    // å¦‚æœæˆåŠŸäº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œç»“æŸ
    console.log(reply);
  },
  (reply) => {
    // å¦‚æœå¤±è´¥äº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œå‘ ç‹å¯Œè´µ å‘é€æ¶ˆæ¯
    console.log(reply);
    sendMessage(
      'ç‹å¯Œè´µ',
      (reply) => {
        // å¦‚æœæˆåŠŸäº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œç»“æŸ
        console.log(reply);
      },
      (reply) => {
        // å¦‚æœå¤±è´¥äº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œå‘ å‘¨èšè´¢ å‘é€æ¶ˆæ¯
        console.log(reply);
        sendMessage(
          'å‘¨èšè´¢',
          (reply) => {
            // å¦‚æœæˆåŠŸäº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œç»“æŸ
            console.log(reply);
          },
          (reply) => {
            // å¦‚æœå¤±è´¥äº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œå‘ åˆ˜äººå‹‡ å‘é€æ¶ˆæ¯
            console.log(reply);
            sendMessage(
              'åˆ˜äººå‹‡',
              (reply) => {
                // å¦‚æœæˆåŠŸäº†ï¼Œè¾“å‡ºå›å¤çš„æ¶ˆæ¯åï¼Œç»“æŸ
                console.log(reply);
              },
              (reply) => {
                // å¦‚æœå¤±è´¥äº†ï¼Œå°±å½»åº•æ²¡æˆäº†
                console.log(reply);
                console.log('é‚“å“¥å‘½çŠ¯å¤©ç…å­¤æ˜Ÿï¼Œæ³¨å®šå­¤ç‹¬ç»ˆè€ï¼ï¼');
              }
            );
          }
        );
      }
    );
  }
);
```



è¯¥ç¨‹åºå®Œæˆåï¼Œé‚“å“¥å†…å¿ƒæ˜¯å´©æºƒçš„



è¿™ä¸€å±‚ä¸€å±‚çš„å›è°ƒåµŒå¥—ï¼Œå½¢æˆäº†ä¼ è¯´ä¸­çš„ã€Œ**å›è°ƒåœ°ç‹± callback hell**ã€



é‚“å“¥æ˜¯ä¸ªå®Œç¾ä¸»ä¹‰è€…ï¼Œæ€ä¹ˆèƒ½å¿å—è¿™æ ·çš„ä»£ç å‘¢ï¼Ÿ



è¦è§£å†³è¿™æ ·çš„é—®é¢˜ï¼Œéœ€è¦Promiseå‡ºé©¬



## Promiseè§„èŒƒ


Promiseæ˜¯ä¸€å¥—ä¸“é—¨å¤„ç†å¼‚æ­¥åœºæ™¯çš„è§„èŒƒï¼Œå®ƒèƒ½æœ‰æ•ˆçš„é¿å…å›è°ƒåœ°ç‹±çš„äº§ç”Ÿï¼Œä½¿å¼‚æ­¥ä»£ç æ›´åŠ æ¸…æ™°ã€ç®€æ´ã€ç»Ÿä¸€



è¿™å¥—è§„èŒƒæœ€æ—©è¯ç”Ÿäºå‰ç«¯ç¤¾åŒºï¼Œè§„èŒƒåç§°ä¸º[Promise A+](https://promisesaplus.com/)



è¯¥è§„èŒƒå‡ºç°åï¼Œç«‹å³å¾—åˆ°äº†å¾ˆå¤šå¼€å‘è€…çš„å“åº”



Promise A+ è§„å®šï¼š



1.  æ‰€æœ‰çš„å¼‚æ­¥åœºæ™¯ï¼Œéƒ½å¯ä»¥çœ‹ä½œæ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œæ¯ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œåœ¨JSä¸­åº”è¯¥è¡¨ç°ä¸ºä¸€ä¸ª**å¯¹è±¡**ï¼Œè¯¥å¯¹è±¡ç§°ä¹‹ä¸º**Promiseå¯¹è±¡**ï¼Œä¹Ÿå«åšä»»åŠ¡å¯¹è±¡ ![alt text](assets/Promise/image-2.png)
2.  æ¯ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œéƒ½åº”è¯¥æœ‰ä¸¤ä¸ªé˜¶æ®µã€ä¸‰ä¸ªçŠ¶æ€ ![alt text](assets/Promise/image-3.png)
æ ¹æ®å¸¸ç†ï¼Œå®ƒä»¬ä¹‹é—´å­˜åœ¨ä»¥ä¸‹é€»è¾‘ï¼š 
    - ä»»åŠ¡æ€»æ˜¯ä»æœªå†³é˜¶æ®µå˜åˆ°å·²å†³é˜¶æ®µï¼Œæ— æ³•é€†è¡Œ
    - ä»»åŠ¡æ€»æ˜¯ä»æŒ‚èµ·çŠ¶æ€å˜åˆ°å®Œæˆæˆ–å¤±è´¥çŠ¶æ€ï¼Œæ— æ³•é€†è¡Œ
    - æ—¶é—´ä¸èƒ½å€’æµï¼Œå†å²ä¸å¯æ”¹å†™ï¼Œä»»åŠ¡ä¸€æ—¦å®Œæˆæˆ–å¤±è´¥ï¼ŒçŠ¶æ€å°±å›ºå®šä¸‹æ¥ï¼Œæ°¸è¿œæ— æ³•æ”¹å˜
3.  `æŒ‚èµ·->å®Œæˆ`ï¼Œç§°ä¹‹ä¸º`resolve`ï¼›`æŒ‚èµ·->å¤±è´¥`ç§°ä¹‹ä¸º`reject`ã€‚ä»»åŠ¡å®Œæˆæ—¶ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªç›¸å…³æ•°æ®ï¼›ä»»åŠ¡å¤±è´¥æ—¶ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªå¤±è´¥åŸå› ã€‚  
![alt text](assets/Promise/image-4.png)
4.  å¯ä»¥é’ˆå¯¹ä»»åŠ¡è¿›è¡Œåç»­å¤„ç†ï¼Œé’ˆå¯¹å®ŒæˆçŠ¶æ€çš„åç»­å¤„ç†ç§°ä¹‹ä¸ºonFulfilledï¼Œé’ˆå¯¹å¤±è´¥çš„åç»­å¤„ç†ç§°ä¹‹ä¸ºonRejected  
![alt text](assets/Promise/image-5.png)



## Promise API


ES6æä¾›äº†ä¸€å¥—APIï¼Œå®ç°äº†Promise A+è§„èŒƒ



åŸºæœ¬ä½¿ç”¨å¦‚ä¸‹ï¼š



```javascript
// åˆ›å»ºä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œè¯¥ä»»åŠ¡ç«‹å³è¿›å…¥ pending çŠ¶æ€
const pro = new Promise((resolve, reject) => {
  // ä»»åŠ¡çš„å…·ä½“æ‰§è¡Œæµç¨‹ï¼Œè¯¥å‡½æ•°ä¼šç«‹å³è¢«æ‰§è¡Œ
  // è°ƒç”¨ resolve(data)ï¼Œå¯å°†ä»»åŠ¡å˜ä¸º fulfilled çŠ¶æ€ï¼Œ data ä¸ºéœ€è¦ä¼ é€’çš„ç›¸å…³æ•°æ®
  // è°ƒç”¨ reject(reason)ï¼Œå¯å°†ä»»åŠ¡å˜ä¸º rejected çŠ¶æ€ï¼Œreason ä¸ºéœ€è¦ä¼ é€’çš„å¤±è´¥åŸå› 
});

pro.then(
  (data) => {
    // onFulfilled å‡½æ•°ï¼Œå½“ä»»åŠ¡å®Œæˆåï¼Œä¼šè‡ªåŠ¨è¿è¡Œè¯¥å‡½æ•°ï¼Œdataä¸ºä»»åŠ¡å®Œæˆçš„ç›¸å…³æ•°æ®
  },
  (reason) => {
    // onRejected å‡½æ•°ï¼Œå½“ä»»åŠ¡å¤±è´¥åï¼Œä¼šè‡ªåŠ¨è¿è¡Œè¯¥å‡½æ•°ï¼Œreasonä¸ºä»»åŠ¡å¤±è´¥çš„ç›¸å…³åŸå› 
  }
);
```



## é‚“å“¥çš„è§£å†³æ–¹æ¡ˆ


å­¦ä¹ äº†ES6çš„Promiseåï¼Œé‚“å“¥å†³å®šå¯¹`sendMessage`å‡½æ•°è¿›è¡Œæ”¹é€ ï¼Œæ”¹é€ ç»“æœå¦‚ä¸‹ï¼š



```javascript
// å‘æŸä½å¥³ç”Ÿå‘é€ä¸€åˆ™è¡¨ç™½çŸ­ä¿¡
// name: å¥³ç¥çš„å§“å
// è¯¥å‡½æ•°è¿”å›ä¸€ä¸ªä»»åŠ¡å¯¹è±¡
function sendMessage(name) {
  return new Promise((resolve, reject) => {
    // æ¨¡æ‹Ÿ å‘é€è¡¨ç™½çŸ­ä¿¡
    console.log(
      `é‚“å“¥ -> ${name}ï¼šæœ€è¿‘æœ‰è°£è¨€è¯´æˆ‘å–œæ¬¢ä½ ï¼Œæˆ‘è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œé‚£ä¸æ˜¯è°£è¨€ğŸ˜˜`
    );
    console.log(`ç­‰å¾…${name}å›å¤......`);
    // æ¨¡æ‹Ÿ å¥³ç¥å›å¤éœ€è¦ä¸€æ®µæ—¶é—´
    setTimeout(() => {
      // æ¨¡æ‹Ÿ æœ‰10%çš„å‡ ç‡æˆåŠŸ
      if (Math.random() <= 0.1) {
        // æˆåŠŸï¼Œè°ƒç”¨ resolveï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        resolve(`${name} -> é‚“å“¥ï¼šæˆ‘æ˜¯ä¹ï¼Œä½ æ˜¯ä¸‰ï¼Œé™¤äº†ä½ è¿˜æ˜¯ä½ ğŸ˜˜`);
      } else {
        // å¤±è´¥ï¼Œè°ƒç”¨ rejectï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        reject(`${name} -> é‚“å“¥ï¼šä½ æ˜¯ä¸ªå¥½äººğŸ˜œ`);
      }
    }, 1000);
  });
}
```



ä¹‹åï¼Œå°±å¯ä»¥ä½¿ç”¨è¯¥å‡½æ•°æ¥å‘é€æ¶ˆæ¯äº†



```javascript
sendMessage('æå»ºå›½').then(
  (reply) => {
    // å¥³ç¥ç­”åº”äº†ï¼Œè¾“å‡ºå¥³ç¥çš„å›å¤
    console.log(reply);
  },
  (reason) => {
    // å¥³ç¥æ‹’ç»äº†ï¼Œè¾“å‡ºå¥³ç¥çš„å›å¤
    console.log(reason);
  }
);
```



> è‡³æ­¤ï¼Œå›è°ƒåœ°ç‹±çš„é—®é¢˜ä»ç„¶æ²¡èƒ½è§£å†³
>
>  
>
> è¦è§£å†³å›è°ƒåœ°ç‹±ï¼Œè¿˜éœ€è¦è¿›ä¸€æ­¥å­¦ä¹ Promiseçš„çŸ¥è¯†
>

## Promiseçš„é“¾å¼è°ƒç”¨

![alt text](assets/Promise/image-6.png)



## catchæ–¹æ³•


`.catch(onRejected)` = `.then(null, onRejected)`



## é“¾å¼è°ƒç”¨


![alt text](assets/Promise/image-7.png)

**!! ä¸‹é¢æ˜¯é‡ç‚¹**

_åç»­å¤„ç† å°±æ˜¯ æ–°ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹ã€‚_

1.  thenæ–¹æ³•å¿…å®šä¼šè¿”å›ä¸€ä¸ªæ–°çš„Promise  
å¯ç†è§£ä¸º`åç»­å¤„ç†ä¹Ÿæ˜¯ä¸€ä¸ªä»»åŠ¡` 
2.  æ–°ä»»åŠ¡çš„çŠ¶æ€å–å†³äºåç»­å¤„ç†ï¼š 
    -  è‹¥æ²¡æœ‰ç›¸å…³çš„åç»­å¤„ç†ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€å’Œå‰ä»»åŠ¡ä¸€è‡´ï¼Œæ•°æ®ä¸ºå‰ä»»åŠ¡çš„æ•°æ® 
    -  è‹¥æœ‰åç»­å¤„ç†ä½†è¿˜æœªæ‰§è¡Œï¼Œæ–°ä»»åŠ¡æŒ‚èµ·ã€‚ 
    -  è‹¥åç»­å¤„ç†æ‰§è¡Œäº†ï¼Œåˆ™æ ¹æ®åç»­å¤„ç†çš„æƒ…å†µç¡®å®šæ–°ä»»åŠ¡çš„çŠ¶æ€ 
        * åç»­å¤„ç†æ‰§è¡Œæ— é”™ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€ä¸ºå®Œæˆï¼ˆæˆåŠŸï¼‰ï¼Œæ•°æ®ä¸ºåç»­å¤„ç†çš„è¿”å›å€¼
        * åç»­å¤„ç†æ‰§è¡Œæœ‰é”™ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€ä¸ºå¤±è´¥ï¼ˆå¤±è´¥ï¼‰ï¼Œæ•°æ®ä¸ºå¼‚å¸¸å¯¹è±¡
        * åç»­æ‰§è¡Œåè¿”å›çš„æ˜¯ä¸€ä¸ªä»»åŠ¡å¯¹è±¡ï¼Œæ–°ä»»åŠ¡çš„çŠ¶æ€å’Œæ•°æ®ä¸è¯¥ä»»åŠ¡å¯¹è±¡ä¸€è‡´



ç”±äºé“¾å¼ä»»åŠ¡çš„å­˜åœ¨ï¼Œå¼‚æ­¥ä»£ç æ‹¥æœ‰äº†æ›´å¼ºçš„è¡¨è¾¾åŠ›



```javascript
// å¸¸è§ä»»åŠ¡å¤„ç†ä»£ç 

/*
 * ä»»åŠ¡æˆåŠŸåï¼Œæ‰§è¡Œå¤„ç†1ï¼Œå¤±è´¥åˆ™æ‰§è¡Œå¤„ç†2
 */
pro.then(å¤„ç†1).catch(å¤„ç†2)

/*
 * ä»»åŠ¡æˆåŠŸåï¼Œä¾æ¬¡æ‰§è¡Œå¤„ç†1ã€å¤„ç†2
 */
pro.then(å¤„ç†1).then(å¤„ç†2)

/*
 * ä»»åŠ¡æˆåŠŸåï¼Œä¾æ¬¡æ‰§è¡Œå¤„ç†1ã€å¤„ç†2ï¼Œè‹¥ä»»åŠ¡å¤±è´¥æˆ–å‰é¢çš„å¤„ç†æœ‰é”™ï¼Œæ‰§è¡Œå¤„ç†3
 */
pro.then(å¤„ç†1).then(å¤„ç†2).catch(å¤„ç†3)
```



## é‚“å“¥çš„è§£å†³æ–¹æ¡ˆ


```javascript
// å‘æŸä½å¥³ç”Ÿå‘é€ä¸€åˆ™è¡¨ç™½çŸ­ä¿¡
// name: å¥³ç¥çš„å§“å
// onFulffiled: æˆåŠŸåçš„å›è°ƒ
// onRejected: å¤±è´¥åçš„å›è°ƒ
function sendMessage(name) {
  return new Promise((resolve, reject) => {
    // æ¨¡æ‹Ÿ å‘é€è¡¨ç™½çŸ­ä¿¡
    console.log(
      `é‚“å“¥ -> ${name}ï¼šæœ€è¿‘æœ‰è°£è¨€è¯´æˆ‘å–œæ¬¢ä½ ï¼Œæˆ‘è¦æ¾„æ¸…ä¸€ä¸‹ï¼Œé‚£ä¸æ˜¯è°£è¨€ğŸ˜˜`
    );
    console.log(`ç­‰å¾…${name}å›å¤......`);
    // æ¨¡æ‹Ÿ å¥³ç¥å›å¤éœ€è¦ä¸€æ®µæ—¶é—´
    setTimeout(() => {
      // æ¨¡æ‹Ÿ æœ‰10%çš„å‡ ç‡æˆåŠŸ
      if (Math.random() <= 0.1) {
        // æˆåŠŸï¼Œè°ƒç”¨ onFuffiledï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        resolve(`${name} -> é‚“å“¥ï¼šæˆ‘æ˜¯ä¹ï¼Œä½ æ˜¯ä¸‰ï¼Œé™¤äº†ä½ è¿˜æ˜¯ä½ ğŸ˜˜`);
      } else {
        // å¤±è´¥ï¼Œè°ƒç”¨ onRejectedï¼Œå¹¶ä¼ é€’å¥³ç¥çš„å›å¤
        reject(`${name} -> é‚“å“¥ï¼šä½ æ˜¯ä¸ªå¥½äººğŸ˜œ`);
      }
    }, 1000);
  });
}

sendMessage('æå»ºå›½')
  .catch((reply) => {
    // å¤±è´¥ï¼Œç»§ç»­
    console.log(reply);
    return sendMessage('ç‹å¯Œè´µ');
  })
  .catch((reply) => {
    // å¤±è´¥ï¼Œç»§ç»­
    console.log(reply);
    return sendMessage('å‘¨èšè´¢');
  })
  .catch((reply) => {
    // å¤±è´¥ï¼Œç»§ç»­
    console.log(reply);
    return sendMessage('åˆ˜äººå‹‡');
  })
  .then(
    (reply) => {
      // æˆåŠŸï¼Œç»“æŸ
      console.log(reply);
      console.log('é‚“å“¥ç»ˆäºæ‰¾åˆ°äº†è‡ªå·±çš„ä¼´ä¾£');
    },
    (reply) => {
      // æœ€åä¸€ä¸ªä¹Ÿå¤±è´¥äº†
      console.log(reply);
      console.log('é‚“å“¥å‘½çŠ¯å¤©ç…å­¤æ˜Ÿï¼Œæ— ä¼´ç»ˆè€ï¼Œå­¤ç‹¬ä¸€ç”Ÿ');
    }
  );
```

## é‚“å“¥çš„æ–°é—®é¢˜


é‚“å«‚å‡ºé—¨æ—¶ï¼Œç»™é‚“å“¥äº¤å¾…äº†å‡ ä¸ªä»»åŠ¡ï¼š



1.  åšé¥­  
å¯äº¤ç»™ç”µé¥­ç…²å®Œæˆ 
2.  æ´—è¡£æœ  
å¯äº¤ç»™æ´—è¡£æœºå®Œæˆ 
3.  æ‰“æ‰«å«ç”Ÿ  
å¯äº¤ç»™æ‰«åœ°æœºå™¨äººå®Œæˆ 



é‚“å“¥éœ€è¦åœ¨æ‰€æœ‰ä»»åŠ¡ç»“æŸåç»™é‚“å«‚æ±‡æŠ¥å·¥ä½œï¼Œå“ªäº›æˆåŠŸäº†ï¼Œå“ªäº›å¤±è´¥äº†



ä¸ºäº†æœ€å¤§ç¨‹åº¦çš„èŠ‚çº¦æ—¶é—´ï¼Œé‚“å“¥å¸Œæœ›è¿™äº›ä»»åŠ¡åŒæ—¶è¿›è¡Œï¼Œæœ€ç»ˆæ±‡æ€»ç»“æœç»Ÿä¸€å¤„ç†



![alt text](assets/Promise/image-8.png)



æ¯ä¸ªä»»åŠ¡å¯ä»¥çœ‹åšæ˜¯ä¸€ä¸ªè¿”å›Promiseçš„å‡½æ•°



```javascript
// åšé¥­
function cook() {
  return new Promise((resolve, reject) => {
    console.log('é‚“å“¥æ‰“å¼€äº†ç”µé¥­ç…²');
    setTimeout(() => {
      if (Math.random() < 0.5) {
        resolve('é¥­å·²ok');
      } else {
        reject('åšé¥­å´å¿˜äº†åŠ æ°´ï¼Œç±³é¥­å˜æˆäº†çˆ†ç±³èŠ±');
      }
    }, 2000);
  });
}

// æ´—è¡£æœ
function wash() {
  return new Promise((resolve, reject) => {
    console.log('é‚“å“¥æ‰“å¼€äº†æ´—è¡£æœº');
    setTimeout(() => {
      if (Math.random() < 0.5) {
        resolve('è¡£æœå·²ç»æ´—å¥½');
      } else {
        reject('æ´—è¡£æœæ—¶åœæ°´äº†ï¼Œæ´—äº†ä¸ªå¯‚å¯');
      }
    }, 2500);
  });
}

// æ‰“æ‰«å«ç”Ÿ
function sweep() {
  return new Promise((resolve, reject) => {
    console.log('é‚“å“¥æ‰“å¼€äº†æ‰«åœ°æœºå™¨äºº');
    setTimeout(() => {
      if (Math.random() < 0.5) {
        resolve('åœ°æ¿æ‰«çš„éå¸¸å¹²å‡€');
      } else {
        reject('æ‰«åœ°æœºå™¨äººè¢«å“ˆå£«å¥‡ä¸€çˆªæ€ç¿»äº†');
      }
    }, 3000);
  });
}
```



å¦‚ä½•åˆ©ç”¨è¿™ä¸‰ä¸ªå‡½æ•°å®ç°é‚“å“¥çš„è¦æ±‚å‘¢ï¼Ÿ



## Promiseçš„é™æ€æ–¹æ³•
| æ–¹æ³•å | å«ä¹‰ |
| --- | --- |
| Promise.resolve(data) | ç›´æ¥è¿”å›ä¸€ä¸ªå®ŒæˆçŠ¶æ€çš„ä»»åŠ¡ |
| Promise.reject(reason) | ç›´æ¥è¿”å›ä¸€ä¸ªæ‹’ç»çŠ¶æ€çš„ä»»åŠ¡ |
| Promise.all(ä»»åŠ¡æ•°ç»„) | è¿”å›ä¸€ä¸ªä»»åŠ¡   ä»»åŠ¡æ•°ç»„å…¨éƒ¨æˆåŠŸåˆ™æˆåŠŸ   ä»»ä½•ä¸€ä¸ªå¤±è´¥åˆ™å¤±è´¥ |
| Promise.any(ä»»åŠ¡æ•°ç»„) | è¿”å›ä¸€ä¸ªä»»åŠ¡   ä»»åŠ¡æ•°ç»„ä»»ä¸€æˆåŠŸåˆ™æˆåŠŸ   ä»»åŠ¡å…¨éƒ¨å¤±è´¥åˆ™å¤±è´¥ |
| Promise.allSettled(ä»»åŠ¡æ•°ç»„) | è¿”å›ä¸€ä¸ªä»»åŠ¡   ä»»åŠ¡æ•°ç»„å…¨éƒ¨å·²å†³åˆ™æˆåŠŸ   è¯¥ä»»åŠ¡ä¸ä¼šå¤±è´¥ |
| Promise.race(ä»»åŠ¡æ•°ç»„) | è¿”å›ä¸€ä¸ªä»»åŠ¡   ä»»åŠ¡æ•°ç»„ä»»ä¸€å·²å†³åˆ™å·²å†³ï¼ŒçŠ¶æ€å’Œå…¶ä¸€è‡´ |
| | |




## é‚“å“¥çš„è§£å†³æ–¹æ¡ˆ


```javascript
Promise.allSettled([cook(), wash(), sweep()]).then((result) => {
  // å¤„ç†æ±‡æ€»ç»“æœ
  const report = result
    .map((r) => (r.status === 'fulfilled' ? r.value : r.reason))
    .join(';');
  console.log(report);
});
```



